<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="productoption">
	
	<insert id="insertName" parameterType="productoptionvo">
		<![CDATA[
			insert into product_option_name(no, product_no, name)
			values(
				nextval('seq_product_option_name_no'), 
				(select last_value from seq_product_no), 
				#{ name }
			);
		]]>
	</insert>
	
	<insert id="insertValue" parameterType="productoptionvaluevo">
		<![CDATA[
			insert into product_option_value(product_option_name_no, value)
			values(
				(select last_value from seq_product_option_name_no), 
				#{ value }
			);
		]]>
	</insert>
	
	<insert id="insertItem" parameterType="productoptionitemvo">
		<![CDATA[
			insert into product_option_item(no, product_no, option_name_keys, option_value_keys, details, additional_amount, availability, manage_status, stock_quantity)
			values(
				nextval('seq_product_option_item_no'),
				(select last_value from seq_product_no),
				#{ optionNameKeys },
				#{ optionValueKeys },
				#{ details },
				#{ additionalAmount },
				#{ availability },
				'${ manageStatus }',
				#{ stockQuantity }
			);
		]]>
	</insert>





<!-- 	<insert id="insert" parameterType="categoryvo"> -->
<!-- 		<![CDATA[ -->
<!-- 			insert  -->
<!-- 			into category(no, name, parent_no) -->
<!-- 			values(nextval('seq_category_no'), #{ name }, #{ parentNo }); -->
<!-- 		]]> -->
<!-- 	</insert> -->
	
<!-- 	<select id="getAll" resultType="map"> -->
<!-- 		<![CDATA[ -->
<!-- 			with recursive sub_category(no, name, parent_no, level, path, cycle) as ( -->
<!-- 				select c.no, c.name, c.parent_no, 0, array[c.no], false -->
<!-- 				from category c -->
<!-- 				where parent_no is null -->
	
<!-- 				union all -->
	
<!-- 				select c.no, c.name, c.parent_no, level + 1, path || c.no, c.no = any(path) -->
<!-- 				from category c, sub_category sb -->
<!-- 				where c.parent_no = sb.no and not cycle	 -->
<!-- 			) -->
<!-- 			select no, parent_no, name, level, path -->
<!-- 			from sub_category -->
<!-- 			order by path; -->
<!-- 		]]> -->
<!-- 	</select> -->
	
<!-- 	<select id="getAllParents" resultType="map"> -->
<!-- 		<![CDATA[ -->
<!-- 			select * -->
<!-- 			from category -->
<!-- 			where parent_no is null -->
<!-- 			order by no asc; -->
<!-- 		]]> -->
<!-- 	</select> -->
	
<!-- 	<select id="getChildren" parameterType="long" resultType="map"> -->
<!-- 		<![CDATA[ -->
<!-- 			with recursive sub_category as ( -->
<!-- 				select * -->
<!-- 				from category -->
<!-- 				where no = #{ value } -->
	
<!-- 				union all -->
	
<!-- 				select c.* -->
<!-- 				from category as c -->
<!-- 				join sub_category as sc -->
<!-- 				on (c.parent_no = sc.no) -->
<!-- 			) -->
<!-- 			select * from sub_category order by no; -->
<!-- 		]]> -->
<!-- 	</select> -->
	
<!-- 	<select id="get" parameterType="long" resultType="categoryvo"> -->
<!-- 		select * -->
<!-- 		from category -->
<!-- 		where no = #{ value }; -->
<!-- 	</select> -->
	
<!-- 	<update id="update" parameterType="categoryvo"> -->
<!-- 		<![CDATA[ -->
<!-- 			update category -->
<!-- 			set -->
<!-- 			name = #{ name }, -->
<!-- 			parent_no = #{ parentNo } -->
<!-- 			where no = #{ no }; -->
<!-- 		]]> -->
<!-- 	</update> -->
	
<!-- 	<delete id="delete" parameterType="long"> -->
<!-- 		<![CDATA[ -->
<!-- 			delete -->
<!-- 			from product_category -->
<!-- 			where category_no = #{ value }; -->
		
<!-- 			delete -->
<!-- 			from category -->
<!-- 			where no = #{ value }; -->
<!-- 		]]> -->
<!-- 	</delete> -->

</mapper>
